{"version":3,"sources":["./src/app/pages/menu-stats/menu-stats-routing.module.ts","./src/app/services/menu-stats.service.ts","./src/app/pages/menu-stats/menu-stats.page.ts","./src/app/pages/menu-stats/menu-stats.page.html","./src/app/pages/menu-stats/menu-stats.page.scss","./src/app/pages/menu-stats/menu-stats.module.ts"],"names":[],"mappings":"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","file":"pages-menu-stats-menu-stats-module-es2015.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { MenuStatsPage } from './menu-stats.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: MenuStatsPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class MenuStatsPageRoutingModule {}\n","import { Injectable } from '@angular/core';\nimport { AngularFirestore, AngularFirestoreCollection, DocumentData} from '@angular/fire/firestore';\nimport * as firebase from 'firebase'; \n\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class MenuStatsService { \n  constructor(private fs:AngularFirestore) { }\n\n\n  async getStatsData(time:number,cid:string,mid:string): Promise<DocumentData> { \n    let dateStart = new Date(time);\n    return this.fs.collection('channels').doc(cid).collection('messages').doc(mid).collection('visitors').ref.where('created_at','>',dateStart)\n  }\n\n\n}\n","import { Component, OnInit } from '@angular/core';\nimport { DocumentData } from '@angular/fire/firestore';\nimport { ActivatedRoute } from '@angular/router';\nimport { MenuStatsService } from 'src/app/services/menu-stats.service'; \nimport * as firebase from 'firebase'; \nimport { Location } from '@angular/common';\nimport { LoadingController } from '@ionic/angular';\n\n@Component({\n  selector: 'app-menu-stats',\n  templateUrl: './menu-stats.page.html',\n  styleUrls: ['./menu-stats.page.scss'],\n})\nexport class MenuStatsPage implements OnInit {\n  cid: string;\n  stats_data: DocumentData[]=[];\n  mid: string; \n  lastDay:number = 30;\n  serverTime:number;\n  visitor_count=[];\n  visitor_sigular_count=[];\n\n  constructor(public route: ActivatedRoute,\n              private loadingController: LoadingController,\n              public location:Location,\n              private menuStatsService:MenuStatsService) { }\n\n  async ngOnInit() {\n    this.cid  = this.route.snapshot.paramMap.get('cid');\n    this.mid  = this.route.snapshot.paramMap.get('mid');\n    this.serverTime = await this.getServerTime()  ;\n    this.getVisitorsDatas();\n  }\n\n  async getServerTime(){\n    let time = Date.now();\n    await firebase.database().ref('/.info/serverTimeOffset')\n            .once('value')\n            .then(function stv(data) {\n              time = (data.val() + Date.now());\n            }, function (err) {\n              console.error(\"Server Time alınırken \" , err.message)\n            });\n    \n    return time;\n  }\n\n  async getVisitorsDatas(){\n\n    const loading = await this.loadingController.create({ \n      message: 'Please wait...',\n      duration: 5000\n    });    \n    await loading.present();\n    \n    let serverTime = this.serverTime - (this.lastDay * 24 * 60 * 60 * 1000);\n    this.menuStatsService.getStatsData(serverTime,this.cid,this.mid).then((async ref=>{\n      await loading.dismiss();\n      ref.get().then((snapshot:DocumentData)=>{\n        this.stats_data = snapshot.docs.map((doc: DocumentData)=>{ \n          return {...doc.data()}\n        })        \n        this.visitorCount(30)\n        this.singularVisitorCount(30)\n        this.visitorCount(7)\n        this.singularVisitorCount(7)\n        this.visitorCount(1)\n        this.singularVisitorCount(1)\n        this.visitorCount(1/24)\n        this.singularVisitorCount(1/24)\n      })\n    })) \n  }\n\n  visitorCount(day_count:number){\n    let strtTime = this.serverTime - (day_count * 24 * 60 * 60 * 1000)  \n    this.visitor_count[day_count]=0\n    this.stats_data.map(doc=>{\n      if(doc.created_at.seconds > (strtTime/1000)){\n        this.visitor_count[day_count]++\n      }\n    })\n    return this.visitor_count[day_count]\n  }\n\n  singularVisitorCount(day_count:number){\n    let strtTime = this.serverTime - (day_count * 24 * 60 * 60 * 1000) \n    this.visitor_sigular_count=[]\n    this.stats_data.map(doc=>{ \n      if(doc.created_at.seconds > (strtTime/1000)){ \n        if(!this.visitor_sigular_count[doc.uid]){\n          this.visitor_sigular_count[doc.uid]=1;\n        }\n      }\n    })\n\n    return Object.keys(this.visitor_sigular_count).length;\n  }\n\n\n  back(){\n    this.location.back();\n  }\n  \n\n}\n","export default \"<ion-toolbar>\\n  <ion-tabs>\\n    <ion-tab-bar slot=\\\"top\\\">\\n      <ion-button  fill=\\\"clear\\\" size=\\\"small\\\"  (click)=\\\"back()\\\" >\\n        <ion-icon name=\\\"chevron-back-outline\\\" ></ion-icon>\\n      </ion-button> \\n      <ion-title>Menu İstatistikleri</ion-title>\\n    </ion-tab-bar>\\n    </ion-tabs>\\n</ion-toolbar>\\n \\n \\n\\n<ion-content>\\n  \\n  <ion-card  >\\n    <ion-item>   \\n      <ion-card-title color=\\\"secondary\\\">Son 30 Gün</ion-card-title>    \\n      <ion-icon slot=\\\"start\\\" name=\\\"calendar-outline\\\"></ion-icon>\\n    </ion-item> \\n    <ion-card-content>\\n      <ion-item lines=\\\"none\\\">\\n        <ion-label color=\\\"medium\\\">Toplam </ion-label> \\n        <ion-badge color=\\\"medium\\\" slot=\\\"end\\\">{{visitorCount(30)}}</ion-badge>\\n      </ion-item>\\n      <ion-item  lines=\\\"none\\\"> \\n        <ion-label color=\\\"medium\\\">Tekil </ion-label> \\n        <ion-badge color=\\\"warning\\\" slot=\\\"end\\\">{{singularVisitorCount(30)}}</ion-badge>\\n      </ion-item>\\n    </ion-card-content>\\n  </ion-card>\\n  \\n  <ion-card>\\n    <ion-item>   \\n      <ion-card-title color=\\\"secondary\\\">Son Yedi Gün</ion-card-title>    \\n      <ion-icon slot=\\\"start\\\" name=\\\"calendar-outline\\\"></ion-icon>\\n    </ion-item> \\n    <ion-card-content>\\n      <ion-item lines=\\\"none\\\">\\n        <ion-label color=\\\"medium\\\">Toplam </ion-label> \\n        <ion-badge color=\\\"medium\\\" slot=\\\"end\\\">{{visitorCount(7)}}</ion-badge>\\n      </ion-item>\\n      <ion-item  lines=\\\"none\\\"> \\n        <ion-label color=\\\"medium\\\">Tekil </ion-label> \\n        <ion-badge color=\\\"warning\\\" slot=\\\"end\\\">{{singularVisitorCount(7)}}</ion-badge>\\n      </ion-item>\\n    </ion-card-content>\\n  </ion-card>\\n  \\n  <ion-card>\\n    <ion-item>   \\n      <ion-card-title color=\\\"secondary\\\">Son 24 Saat</ion-card-title>    \\n      <ion-icon slot=\\\"start\\\" name=\\\"today-outline\\\"></ion-icon>\\n    </ion-item> \\n    <ion-card-content>\\n      <ion-item lines=\\\"none\\\">\\n        <ion-label color=\\\"medium\\\">Toplam </ion-label> \\n        <ion-badge color=\\\"medium\\\" slot=\\\"end\\\">{{visitorCount(1)}}</ion-badge>\\n      </ion-item>\\n      <ion-item  lines=\\\"none\\\"> \\n        <ion-label color=\\\"medium\\\">Tekil </ion-label> \\n        <ion-badge color=\\\"warning\\\" slot=\\\"end\\\">{{singularVisitorCount(1)}}</ion-badge>\\n      </ion-item>\\n    </ion-card-content>\\n  </ion-card> \\n  \\n  <ion-card>\\n    <ion-item>   \\n      <ion-card-title color=\\\"secondary\\\">Son Bir Saat</ion-card-title>    \\n      <ion-icon slot=\\\"start\\\" name=\\\"alarm-outline\\\"></ion-icon>\\n    </ion-item> \\n    <ion-card-content>\\n      <ion-item lines=\\\"none\\\">\\n        <ion-label color=\\\"medium\\\">Toplam </ion-label> \\n        <ion-badge color=\\\"medium\\\" slot=\\\"end\\\">{{visitorCount(1/24)}}</ion-badge>\\n      </ion-item>\\n      <ion-item  lines=\\\"none\\\"> \\n        <ion-label color=\\\"medium\\\">Tekil </ion-label> \\n        <ion-badge color=\\\"warning\\\" slot=\\\"end\\\">{{singularVisitorCount(1/24)}}</ion-badge>\\n      </ion-item>\\n    </ion-card-content>\\n  </ion-card> \\n\\n</ion-content>\\n\";","export default \"/*\\nion-card-content ion-badge{\\n    font-size: 32px;\\n}\\n\\nion-card{\\n    box-shadow:none;\\n    border:1px solid rgb(235, 230, 211);\\n}\\n*/\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL21lbnUtc3RhdHMucGFnZS5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Q0FBQSIsImZpbGUiOiJtZW51LXN0YXRzLnBhZ2Uuc2NzcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5pb24tY2FyZC1jb250ZW50IGlvbi1iYWRnZXtcbiAgICBmb250LXNpemU6IDMycHg7XG59XG5cbmlvbi1jYXJke1xuICAgIGJveC1zaGFkb3c6bm9uZTtcbiAgICBib3JkZXI6MXB4IHNvbGlkIHJnYigyMzUsIDIzMCwgMjExKTtcbn1cbiovIl19 */\";","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { MenuStatsPageRoutingModule } from './menu-stats-routing.module';\n\nimport { MenuStatsPage } from './menu-stats.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    MenuStatsPageRoutingModule\n  ],\n  declarations: [MenuStatsPage]\n})\nexport class MenuStatsPageModule {}\n"],"sourceRoot":"webpack:///"}