{"version":3,"sources":["webpack:///src/app/pages/menu-stats/menu-stats-routing.module.ts","webpack:///src/app/services/menu-stats.service.ts","webpack:///src/app/pages/menu-stats/menu-stats.page.ts","webpack:///src/app/pages/menu-stats/menu-stats.page.html","webpack:///src/app/pages/menu-stats/menu-stats.page.scss","webpack:///src/app/pages/menu-stats/menu-stats.module.ts"],"names":["routes","path","component","MenuStatsPageRoutingModule","imports","forChild","exports","MenuStatsService","fs","time","cid","mid","dateStart","Date","collection","doc","ref","where","providedIn","MenuStatsPage","route","loadingController","location","menuStatsService","stats_data","lastDay","visitor_count","visitor_sigular_count","snapshot","paramMap","get","getServerTime","serverTime","getVisitorsDatas","now","once","then","stv","data","val","err","console","error","message","create","duration","loading","present","getStatsData","dismiss","docs","map","visitorCount","singularVisitorCount","day_count","strtTime","created_at","seconds","uid","Object","keys","length","back","selector","template","MenuStatsPageModule","declarations"],"mappings":"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","file":"pages-menu-stats-menu-stats-module-es5.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { MenuStatsPage } from './menu-stats.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: MenuStatsPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class MenuStatsPageRoutingModule {}\n","import { Injectable } from '@angular/core';\nimport { AngularFirestore, AngularFirestoreCollection, DocumentData} from '@angular/fire/firestore';\nimport * as firebase from 'firebase'; \n\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class MenuStatsService { \n  constructor(private fs:AngularFirestore) { }\n\n\n  async getStatsData(time:number,cid:string,mid:string): Promise<DocumentData> { \n    let dateStart = new Date(time);\n    return this.fs.collection('channels').doc(cid).collection('messages').doc(mid).collection('visitors').ref.where('created_at','>',dateStart)\n  }\n\n\n}\n","import { Component, OnInit } from '@angular/core';\nimport { DocumentData } from '@angular/fire/firestore';\nimport { ActivatedRoute } from '@angular/router';\nimport { MenuStatsService } from 'src/app/services/menu-stats.service'; \nimport * as firebase from 'firebase'; \nimport { Location } from '@angular/common';\nimport { LoadingController } from '@ionic/angular';\n\n@Component({\n  selector: 'app-menu-stats',\n  templateUrl: './menu-stats.page.html',\n  styleUrls: ['./menu-stats.page.scss'],\n})\nexport class MenuStatsPage implements OnInit {\n  cid: string;\n  stats_data: DocumentData[]=[];\n  mid: string; \n  lastDay:number = 30;\n  serverTime:number;\n  visitor_count=[];\n  visitor_sigular_count=[];\n\n  constructor(public route: ActivatedRoute,\n              private loadingController: LoadingController,\n              public location:Location,\n              private menuStatsService:MenuStatsService) { }\n\n  async ngOnInit() {\n    this.cid  = this.route.snapshot.paramMap.get('cid');\n    this.mid  = this.route.snapshot.paramMap.get('mid');\n    this.serverTime = await this.getServerTime()  ;\n    this.getVisitorsDatas();\n  }\n\n  async getServerTime(){\n    let time = Date.now();\n    await firebase.database().ref('/.info/serverTimeOffset')\n            .once('value')\n            .then(function stv(data) {\n              time = (data.val() + Date.now());\n            }, function (err) {\n              console.error(\"Server Time alınırken \" , err.message)\n            });\n    \n    return time;\n  }\n\n  async getVisitorsDatas(){\n\n    const loading = await this.loadingController.create({ \n      message: 'Please wait...',\n      duration: 5000\n    });    \n    await loading.present();\n    \n    let serverTime = this.serverTime - (this.lastDay * 24 * 60 * 60 * 1000);\n    this.menuStatsService.getStatsData(serverTime,this.cid,this.mid).then((async ref=>{\n      await loading.dismiss();\n      ref.get().then((snapshot:DocumentData)=>{\n        this.stats_data = snapshot.docs.map((doc: DocumentData)=>{ \n          return {...doc.data()}\n        })        \n        this.visitorCount(30)\n        this.singularVisitorCount(30)\n        this.visitorCount(7)\n        this.singularVisitorCount(7)\n        this.visitorCount(1)\n        this.singularVisitorCount(1)\n        this.visitorCount(1/24)\n        this.singularVisitorCount(1/24)\n      })\n    })) \n  }\n\n  visitorCount(day_count:number){\n    let strtTime = this.serverTime - (day_count * 24 * 60 * 60 * 1000)  \n    this.visitor_count[day_count]=0\n    this.stats_data.map(doc=>{\n      if(doc.created_at.seconds > (strtTime/1000)){\n        this.visitor_count[day_count]++\n      }\n    })\n    return this.visitor_count[day_count]\n  }\n\n  singularVisitorCount(day_count:number){\n    let strtTime = this.serverTime - (day_count * 24 * 60 * 60 * 1000) \n    this.visitor_sigular_count=[]\n    this.stats_data.map(doc=>{ \n      if(doc.created_at.seconds > (strtTime/1000)){ \n        if(!this.visitor_sigular_count[doc.uid]){\n          this.visitor_sigular_count[doc.uid]=1;\n        }\n      }\n    })\n\n    return Object.keys(this.visitor_sigular_count).length;\n  }\n\n\n  back(){\n    this.location.back();\n  }\n  \n\n}\n","export default \"<ion-toolbar>\\n  <ion-tabs>\\n    <ion-tab-bar slot=\\\"top\\\">\\n      <ion-button  fill=\\\"clear\\\" size=\\\"small\\\"  (click)=\\\"back()\\\" >\\n        <ion-icon name=\\\"chevron-back-outline\\\" ></ion-icon>\\n      </ion-button> \\n      <ion-title>Menu İstatistikleri</ion-title>\\n    </ion-tab-bar>\\n    </ion-tabs>\\n</ion-toolbar>\\n \\n \\n\\n<ion-content>\\n  \\n  <ion-card  >\\n    <ion-item>   \\n      <ion-card-title color=\\\"secondary\\\">Son 30 Gün</ion-card-title>    \\n      <ion-icon slot=\\\"start\\\" name=\\\"calendar-outline\\\"></ion-icon>\\n    </ion-item> \\n    <ion-card-content>\\n      <ion-item lines=\\\"none\\\">\\n        <ion-label color=\\\"medium\\\">Toplam </ion-label> \\n        <ion-badge color=\\\"medium\\\" slot=\\\"end\\\">{{visitorCount(30)}}</ion-badge>\\n      </ion-item>\\n      <ion-item  lines=\\\"none\\\"> \\n        <ion-label color=\\\"medium\\\">Tekil </ion-label> \\n        <ion-badge color=\\\"warning\\\" slot=\\\"end\\\">{{singularVisitorCount(30)}}</ion-badge>\\n      </ion-item>\\n    </ion-card-content>\\n  </ion-card>\\n  \\n  <ion-card>\\n    <ion-item>   \\n      <ion-card-title color=\\\"secondary\\\">Son Yedi Gün</ion-card-title>    \\n      <ion-icon slot=\\\"start\\\" name=\\\"calendar-outline\\\"></ion-icon>\\n    </ion-item> \\n    <ion-card-content>\\n      <ion-item lines=\\\"none\\\">\\n        <ion-label color=\\\"medium\\\">Toplam </ion-label> \\n        <ion-badge color=\\\"medium\\\" slot=\\\"end\\\">{{visitorCount(7)}}</ion-badge>\\n      </ion-item>\\n      <ion-item  lines=\\\"none\\\"> \\n        <ion-label color=\\\"medium\\\">Tekil </ion-label> \\n        <ion-badge color=\\\"warning\\\" slot=\\\"end\\\">{{singularVisitorCount(7)}}</ion-badge>\\n      </ion-item>\\n    </ion-card-content>\\n  </ion-card>\\n  \\n  <ion-card>\\n    <ion-item>   \\n      <ion-card-title color=\\\"secondary\\\">Son 24 Saat</ion-card-title>    \\n      <ion-icon slot=\\\"start\\\" name=\\\"today-outline\\\"></ion-icon>\\n    </ion-item> \\n    <ion-card-content>\\n      <ion-item lines=\\\"none\\\">\\n        <ion-label color=\\\"medium\\\">Toplam </ion-label> \\n        <ion-badge color=\\\"medium\\\" slot=\\\"end\\\">{{visitorCount(1)}}</ion-badge>\\n      </ion-item>\\n      <ion-item  lines=\\\"none\\\"> \\n        <ion-label color=\\\"medium\\\">Tekil </ion-label> \\n        <ion-badge color=\\\"warning\\\" slot=\\\"end\\\">{{singularVisitorCount(1)}}</ion-badge>\\n      </ion-item>\\n    </ion-card-content>\\n  </ion-card> \\n  \\n  <ion-card>\\n    <ion-item>   \\n      <ion-card-title color=\\\"secondary\\\">Son Bir Saat</ion-card-title>    \\n      <ion-icon slot=\\\"start\\\" name=\\\"alarm-outline\\\"></ion-icon>\\n    </ion-item> \\n    <ion-card-content>\\n      <ion-item lines=\\\"none\\\">\\n        <ion-label color=\\\"medium\\\">Toplam </ion-label> \\n        <ion-badge color=\\\"medium\\\" slot=\\\"end\\\">{{visitorCount(1/24)}}</ion-badge>\\n      </ion-item>\\n      <ion-item  lines=\\\"none\\\"> \\n        <ion-label color=\\\"medium\\\">Tekil </ion-label> \\n        <ion-badge color=\\\"warning\\\" slot=\\\"end\\\">{{singularVisitorCount(1/24)}}</ion-badge>\\n      </ion-item>\\n    </ion-card-content>\\n  </ion-card> \\n\\n</ion-content>\\n\";","export default \"/*\\nion-card-content ion-badge{\\n    font-size: 32px;\\n}\\n\\nion-card{\\n    box-shadow:none;\\n    border:1px solid rgb(235, 230, 211);\\n}\\n*/\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL21lbnUtc3RhdHMucGFnZS5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Q0FBQSIsImZpbGUiOiJtZW51LXN0YXRzLnBhZ2Uuc2NzcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5pb24tY2FyZC1jb250ZW50IGlvbi1iYWRnZXtcbiAgICBmb250LXNpemU6IDMycHg7XG59XG5cbmlvbi1jYXJke1xuICAgIGJveC1zaGFkb3c6bm9uZTtcbiAgICBib3JkZXI6MXB4IHNvbGlkIHJnYigyMzUsIDIzMCwgMjExKTtcbn1cbiovIl19 */\";","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { MenuStatsPageRoutingModule } from './menu-stats-routing.module';\n\nimport { MenuStatsPage } from './menu-stats.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    MenuStatsPageRoutingModule\n  ],\n  declarations: [MenuStatsPage]\n})\nexport class MenuStatsPageModule {}\n"]}